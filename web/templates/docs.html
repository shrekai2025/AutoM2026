{% extends "base.html" %}

{% block content %}
<div class="container animate-fade-in" x-data="{ 
    expanded: null,
    copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            // Optional: Show a subtle toast or change icon
        });
    }
}">
    <div class="mb-10 text-center">
        <h1
            class="text-3xl font-extrabold mb-4 bg-gradient-to-r from-blue-400 to-emerald-400 bg-clip-text text-transparent">
            AutoM2026 Developer Documentation
        </h1>
        <p class="text-muted max-w-2xl mx-auto">
            完整的 API 参考手册。包含输入参数定义、返回数据结构以及默认值说明，助力 AI Agent 与第三方系统的无缝集成。
        </p>
    </div>

    <!-- API Categories -->
    <div class="space-y-8 pb-20">
        {% for cat in api_docs %}
        <section>
            <div class="flex items-center gap-3 mb-4 px-2">
                <div class="w-1.5 h-6 bg-primary rounded-full"></div>
                <h2 class="text-xl font-bold italic">{{ cat.category }}</h2>
            </div>

            <div class="grid grid-cols-1 gap-4">
                {% for api in cat.endpoints %}
                <div class="card overflow-hidden transition-all duration-300 border-border/50 hover:border-primary/30"
                    :class="expanded === '{{ api.path }}' ? 'ring-1 ring-primary/20 shadow-lg mb-4' : ''">

                    <!-- Header -->
                    <div class="p-4 flex flex-wrap items-center justify-between cursor-pointer group"
                        @click="expanded = (expanded === '{{ api.path }}' ? null : '{{ api.path }}')">
                        <div class="flex items-center gap-4 flex-1 min-w-[300px]">
                            <span
                                class="font-mono text-[10px] font-bold tracking-widest uppercase py-1 px-2 rounded 
                                 {{ 'bg-blue-500/10 text-blue-500' if api.method == 'GET' else 'bg-emerald-500/10 text-emerald-500' }}">
                                {{ api.method }}
                            </span>
                            <code
                                class="text-sm font-mono font-bold text-foreground group-hover:text-primary transition-colors">
                                {{ api.path }}
                            </code>
                            <span class="text-sm text-muted hidden md:inline-block">— {{ api.description }}</span>
                        </div>
                        <div class="flex items-center gap-4">
                            <button class="text-muted hover:text-primary p-1 rounded-md transition-colors"
                                @click.stop="copyToClipboard('{{ api.path }}')" title="Copy Path">
                                <i class="ph ph-copy"></i>
                            </button>
                            <i class="ph ph-caret-down transition-transform duration-300"
                                :class="expanded === '{{ api.path }}' ? 'rotate-180 text-primary' : 'text-muted'"></i>
                        </div>
                    </div>

                    <!-- Body -->
                    <div x-show="expanded === '{{ api.path }}'" x-collapse>
                        <div class="p-6 bg-muted/5 border-t border-border/30">
                            <!-- Mobile-only description -->
                            <p class="text-sm text-muted mb-6 md:hidden">{{ api.description }}</p>

                            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                                <!-- Left Column: Parameters -->
                                <div class="lg:col-span-12">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                                        <!-- Inputs -->
                                        <div>
                                            <div class="flex items-center gap-2 mb-4">
                                                <i class="ph ph-sign-in text-primary"></i>
                                                <h4 class="text-sm font-bold uppercase tracking-tight">Input Parameters
                                                </h4>
                                            </div>
                                            {% if api.inputs %}
                                            <div
                                                class="table-container rounded-lg border border-border/50 overflow-hidden">
                                                <table class="w-full text-xs">
                                                    <thead class="bg-muted/10">
                                                        <tr class="text-left">
                                                            <th class="p-3 font-semibold text-muted">Field</th>
                                                            <th class="p-3 font-semibold text-muted">Type</th>
                                                            <th class="p-3 font-semibold text-muted">Default</th>
                                                            <th class="p-3 font-semibold text-muted">Desc</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody class="divide-y divide-border/30">
                                                        {% for inp in api.inputs %}
                                                        <tr class="hover:bg-muted/5 transition-colors">
                                                            <td class="p-3">
                                                                <div class="flex flex-col">
                                                                    <code
                                                                        class="text-primary font-bold">{{ inp.name }}</code>
                                                                    {% if inp.required %}<span
                                                                        class="text-[10px] text-bear mt-0.5">Required</span>{%
                                                                    endif %}
                                                                </div>
                                                            </td>
                                                            <td class="p-3"><span class="text-muted-foreground">{{
                                                                    inp.type }}</span></td>
                                                            <td class="p-3"><code
                                                                    class="bg-muted/20 px-1 rounded">{{ inp.default if inp.default is not none else '-' }}</code>
                                                            </td>
                                                            <td class="p-3 text-muted-foreground">{{ inp.description }}
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                            {% else %}
                                            <div
                                                class="p-4 rounded-lg bg-muted/10 border border-dashed border-border/50 text-center text-xs text-muted">
                                                No specific parameters required
                                            </div>
                                            {% endif %}
                                        </div>

                                        <!-- Outputs -->
                                        <div>
                                            <div class="flex items-center gap-2 mb-4">
                                                <i class="ph ph-sign-out text-emerald-400"></i>
                                                <h4 class="text-sm font-bold uppercase tracking-tight">Output Schema
                                                </h4>
                                            </div>
                                            {% if api.outputs %}
                                            <div
                                                class="table-container rounded-lg border border-border/50 overflow-hidden">
                                                <table class="w-full text-xs">
                                                    <thead class="bg-muted/10">
                                                        <tr class="text-left">
                                                            <th class="p-3 font-semibold text-muted">Field</th>
                                                            <th class="p-3 font-semibold text-muted">Type</th>
                                                            <th class="p-3 font-semibold text-muted">Meaning</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody class="divide-y divide-border/30">
                                                        {% for out in api.outputs %}
                                                        <tr class="hover:bg-muted/5 transition-colors">
                                                            <td class="p-3"><code
                                                                    class="text-emerald-400 font-bold">{{ out.name }}</code>
                                                            </td>
                                                            <td class="p-3"><span class="text-muted-foreground">{{
                                                                    out.type }}</span></td>
                                                            <td class="p-3 text-muted-foreground">{{ out.description }}
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                            {% else %}
                                            <p class="text-xs text-muted italic">Dynamic response structure (refer to
                                                example)</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>

                                <!-- Example Box -->
                                <div class="lg:col-span-12">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center gap-2">
                                            <i class="ph ph-code text-primary"></i>
                                            <h4 class="text-sm font-bold uppercase">JSON Response Example</h4>
                                        </div>
                                        <span
                                            class="text-[10px] text-muted-foreground font-mono">application/json</span>
                                    </div>
                                    <pre
                                        class="bg-[#0f172a] p-5 rounded-xl text-xs overflow-x-auto border border-white/5 shadow-2xl relative">
<code class="text-emerald-400 leading-relaxed">{{ api.example | default('{\n  "status": "success",\n  "data": { ... }\n}') }}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endfor %}
    </div>
</div>

<style>
    .card-gradient {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.4) 0%, rgba(15, 23, 42, 0.4) 100%);
        backdrop-filter: blur(8px);
    }

    .badge-blue {
        background: rgba(59, 130, 246, 0.1);
        color: #60a5fa;
    }

    .badge-emerald {
        background: rgba(16, 185, 129, 0.1);
        color: #34d399;
    }
</style>
{% endblock %}