# ä¸‹è·Œè¶‹åŠ¿è·Ÿéšç­–ç•¥ (Downtrend Follow Strategy)

## æ¦‚è¿°

ä¸“æ³¨äºä¸‹è·Œè¶‹åŠ¿ä¸­æ•æ‰åšç©ºæœºä¼šçš„æŠ€æœ¯åˆ†æç­–ç•¥ï¼ŒåŸºäºå¤šæ—¶é—´æ¡†æ¶ç¡®è®¤å’Œä¸¥æ ¼çš„é£é™©ç®¡ç†ã€‚

## ç­–ç•¥é€»è¾‘

### æ ¸å¿ƒåŸç†

æ ¹æ®æˆªå›¾ä¿¡å·åæ¨çš„äº¤æ˜“ç­–ç•¥ï¼Œä¸»è¦ç‰¹å¾ï¼š

1. **è¶‹åŠ¿åˆ¤æ–­**: ä»·æ ¼å¿…é¡»åœ¨ EMA200 ä¸‹æ–¹ï¼ˆé¡ºåŠ¿åšç©ºï¼‰
2. **å…¥åœºç¡®è®¤**: EMAç©ºå¤´æ’åˆ— + MACDæ­»å‰/ç©ºå¤´ + ä¸‹é™è¶‹åŠ¿ç»“æ„
3. **æ­¢æŸè®¡ç®—**: Swing High + ATR Ã— å€æ•°ï¼ˆé»˜è®¤1.5ï¼‰
4. **æ­¢ç›ˆç›®æ ‡**:
   - 1R: é£é™©å›æŠ¥æ¯” 1:1
   - 2R: é£é™©å›æŠ¥æ¯” 1:2
5. **ç¦»åœºå‚è€ƒ**: çªç ´ EMA20 æˆ– MACD é‡‘å‰

### ä¿¡å·åˆ†çº§

- **â­â­â­ å¼ºåŠ›æœºä¼š**:
  - å¤šæ—¶é—´æ¡†æ¶å…±æŒ¯ï¼ˆâ‰¥66%åŒå‘ï¼‰
  - ä¿¡å¿µåˆ†æ•° â‰¤ 25
  - æœ‰ MACD æ­»å‰ç¡®è®¤

- **â­â­ è‰¯å¥½æœºä¼š**:
  - å•æ—¶é—´æ¡†æ¶ç¡®è®¤
  - ä¿¡å¿µåˆ†æ•°åœ¨ 20-35 ä¹‹é—´

## é…ç½®å‚æ•°

```python
config = {
    "symbol": "BTC",                    # äº¤æ˜“æ ‡çš„
    "timeframes": ["15m", "1h", "4h"],  # å¤šæ—¶é—´æ¡†æ¶
    "klines_limit": 300,                # Kçº¿æ•°é‡

    # å…¥åœºæ¡ä»¶
    "ema200_below_required": True,      # å¿…é¡»åœ¨EMA200ä¸‹æ–¹
    "short_threshold": 35,              # åšç©ºé˜ˆå€¼ï¼ˆåˆ†æ•°â‰¤35è§¦å‘ï¼‰
    "min_conviction": 20,               # æœ€ä½ä¿¡å¿µåˆ†æ•°

    # æ­¢æŸ/æ­¢ç›ˆ
    "atr_stop_mult": 1.5,               # æ­¢æŸå€æ•°
    "risk_reward_1r": 1.0,              # ç¬¬ä¸€ç›®æ ‡
    "risk_reward_2r": 2.0,              # ç¬¬äºŒç›®æ ‡
    "swing_lookback": 20,               # Swing Highå›æº¯å‘¨æœŸ

    # ä»“ä½ç®¡ç†
    "base_position_size": 0.20,         # åŸºç¡€ä»“ä½20%
    "max_position_size": 0.50,          # æœ€å¤§ä»“ä½50%
}
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```python
import asyncio
from strategies import DowntrendFollowStrategy

async def main():
    # åˆå§‹åŒ–ç­–ç•¥
    strategy = DowntrendFollowStrategy({
        "symbol": "BTC",
        "timeframes": ["15m", "1h", "4h"],
    })

    # æ‰§è¡Œåˆ†æï¼ˆè‡ªåŠ¨è·å–æ•°æ®ï¼‰
    signal = await strategy.analyze()

    # æ£€æŸ¥ä¿¡å·
    if signal.signal.value == "sell":
        print(f"åšç©ºä¿¡å·: {signal.reason}")
        print(f"å…¥åœº: ${signal.entry_price:,.2f}")
        print(f"æ­¢æŸ: ${signal.stop_loss:,.2f}")
        print(f"æ­¢ç›ˆ1: ${signal.take_profit:,.2f}")
        print(f"æ­¢ç›ˆ2: ${signal.metadata['take_profit_2r']:,.2f}")
        print(f"ä»“ä½: {signal.position_size * 100:.1f}%")

asyncio.run(main())
```

### ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®

```python
# æä¾›è‡ªå·±çš„Kçº¿æ•°æ®
market_data = {
    "klines": {
        "15m": klines_15m,  # List[Dict]
        "1h": klines_1h,
        "4h": klines_4h,
    }
}

signal = await strategy.analyze(market_data)
```

## ä¿¡å·è¾“å‡ºæ ¼å¼

### StrategySignal å¯¹è±¡

```python
{
    "signal": "sell",                    # ä¿¡å·ç±»å‹
    "conviction_score": 28.5,            # ä¿¡å¿µåˆ†æ•°ï¼ˆè¶Šä½è¶Šé€‚åˆåšç©ºï¼‰
    "position_size": 0.35,               # å»ºè®®ä»“ä½35%
    "reason": "â­â­â­ STRONGæœºä¼š | [4h]EMAç©ºå¤´æ’åˆ—; [4h]MACDæ­»å‰ğŸ”´",
    "symbol": "BTC",
    "entry_price": 94200.00,
    "stop_loss": 95800.00,               # æ­¢æŸä»·
    "take_profit": 92600.00,             # æ­¢ç›ˆ1 (1R)
    "metadata": {
        "grade": "strong",               # ä¿¡å·ç­‰çº§
        "take_profit_2r": 91000.00,      # æ­¢ç›ˆ2 (2R)
        "risk": 1600.00,                 # é£é™©é‡‘é¢
        "atr": 450.00,
        "swing_high": 95125.00,
        "exit_condition": "çªç ´EMA20($93500)æˆ–MACDé‡‘å‰",
        "ema20": 93500.00,
        "ema200": 96000.00,
        "score_by_tf": {
            "15m": 32.5,
            "1h": 28.0,
            "4h": 25.0
        }
    }
}
```

## æŠ€æœ¯æŒ‡æ ‡æƒé‡

ç­–ç•¥å†…éƒ¨ä½¿ç”¨ä»¥ä¸‹æŒ‡æ ‡æƒé‡è¿›è¡Œè¯„åˆ†ï¼š

| æŒ‡æ ‡ | æƒé‡ | è¯´æ˜ |
|------|------|------|
| EMAæ’åˆ— | 25% | ç©ºå¤´æ’åˆ—ï¼ˆ9<21<50<200ï¼‰|
| ä»·æ ¼ä½ç½® | 20% | ç›¸å¯¹EMA200çš„ä½ç½® |
| RSI | 15% | é¿å…æç«¯è¶…å–ï¼ˆ<25é£é™©é«˜ï¼‰|
| MACD | 20% | æ­»å‰/ç©ºå¤´ç¡®è®¤ |
| è¶‹åŠ¿ç»“æ„ | 15% | ä¸‹é™è¶‹åŠ¿è¯†åˆ« |
| æˆäº¤é‡ | 5% | æ”¾é‡ä¸‹è·Œç¡®è®¤ |

## é£é™©ç®¡ç†

### æ­¢æŸé€»è¾‘

```
æ­¢æŸä»· = Swing High + ATR Ã— atr_stop_mult
```

- **Swing High**: æœ€è¿‘Næ ¹Kçº¿çš„æœ€é«˜ç‚¹ï¼ˆé»˜è®¤20æ ¹ï¼‰
- **ATR**: å¹³å‡çœŸå®æ³¢å¹…ï¼ŒåŠ¨æ€é€‚åº”å¸‚åœºæ³¢åŠ¨
- **å€æ•°**: é»˜è®¤1.5å€ï¼Œå¯æ ¹æ®é£é™©åå¥½è°ƒæ•´

### æ­¢ç›ˆç›®æ ‡

```
é£é™© = æ­¢æŸä»· - å…¥åœºä»·
æ­¢ç›ˆ1 = å…¥åœºä»· - é£é™© Ã— 1.0  (1R)
æ­¢ç›ˆ2 = å…¥åœºä»· - é£é™© Ã— 2.0  (2R)
```

### ä»“ä½è®¡ç®—

```python
ä»“ä½ = åŸºç¡€ä»“ä½ Ã— ä¿¡å·ç­‰çº§å€æ•° Ã— (1 + ä¿¡å¿µå¼ºåº¦)

ä¿¡å·ç­‰çº§å€æ•°:
- å¼ºåŠ›ä¿¡å·: 1.0
- è‰¯å¥½ä¿¡å·: 0.7

ä¿¡å¿µå¼ºåº¦ = (50 - åˆ†æ•°) / 50  # åˆ†æ•°è¶Šä½å¼ºåº¦è¶Šé«˜
```

## ç¦»åœºæ¡ä»¶

ç­–ç•¥å»ºè®®åœ¨ä»¥ä¸‹æƒ…å†µè€ƒè™‘ç¦»åœºï¼š

1. **ä»·æ ¼çªç ´ EMA20**: çŸ­æœŸè¶‹åŠ¿å¯èƒ½åè½¬
2. **MACD é‡‘å‰**: åŠ¨èƒ½è½¬ä¸ºå¤šå¤´
3. **è¾¾åˆ°æ­¢ç›ˆç›®æ ‡**: 1R æˆ– 2R
4. **è§¦åŠæ­¢æŸ**: ä¸¥æ ¼æ‰§è¡Œæ­¢æŸ

## é€‚ç”¨åœºæ™¯

### æœ€ä½³ä½¿ç”¨åœºæ™¯

- âœ… æ˜ç¡®çš„ä¸‹è·Œè¶‹åŠ¿å¸‚åœº
- âœ… ä»·æ ¼è¿œä½äº EMA200
- âœ… å¤šæ—¶é—´æ¡†æ¶å…±æŒ¯
- âœ… æœ‰ MACD æ­»å‰ç¡®è®¤

### ä¸é€‚ç”¨åœºæ™¯

- âŒ æ¨ªç›˜éœ‡è¡å¸‚åœº
- âŒ ä»·æ ¼é«˜äº EMA200
- âŒ RSI æç«¯è¶…å–ï¼ˆ<25ï¼‰
- âŒ å‡ºç° MACD é‡‘å‰

## å›æµ‹å»ºè®®

```python
# å›æµ‹å‚æ•°å»ºè®®
backtest_config = {
    "initial_capital": 10000,
    "commission": 0.001,              # 0.1% æ‰‹ç»­è´¹
    "slippage": 0.0005,               # 0.05% æ»‘ç‚¹
    "max_positions": 3,               # æœ€å¤š3ä¸ªä»“ä½
    "risk_per_trade": 0.02,           # å•ç¬”é£é™©2%
}
```

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®è´¨é‡**: ç¡®ä¿Kçº¿æ•°æ®å®Œæ•´ä¸”å‡†ç¡®
2. **å¸‚åœºç¯å¢ƒ**: ç­–ç•¥åœ¨è¶‹åŠ¿å¸‚åœºè¡¨ç°æœ€ä½³
3. **é£é™©æ§åˆ¶**: ä¸¥æ ¼æ‰§è¡Œæ­¢æŸï¼Œä¸è¦æŠ±æœ‰ä¾¥å¹¸å¿ƒç†
4. **ä»“ä½ç®¡ç†**: æ ¹æ®ä¿¡å·ç­‰çº§å’Œè´¦æˆ·é£é™©è°ƒæ•´ä»“ä½
5. **å¤šæ ·åŒ–**: ä¸è¦æŠŠæ‰€æœ‰èµ„é‡‘æŠ•å…¥å•ä¸€ç­–ç•¥

## æ€§èƒ½ç›‘æ§

å»ºè®®ç›‘æ§ä»¥ä¸‹æŒ‡æ ‡ï¼š

- èƒœç‡
- ç›ˆäºæ¯”
- æœ€å¤§å›æ’¤
- å¤æ™®æ¯”ç‡
- ä¿¡å·é¢‘ç‡
- å„æ—¶é—´æ¡†æ¶å‡†ç¡®ç‡

## æ›´æ–°æ—¥å¿—

### v1.0 (2026-02-27)
- åˆå§‹ç‰ˆæœ¬
- åŸºäºæˆªå›¾ä¿¡å·åæ¨å®ç°
- æ”¯æŒå¤šæ—¶é—´æ¡†æ¶åˆ†æ
- é›†æˆ ATR åŠ¨æ€æ­¢æŸ
- ä¿¡å·åˆ†çº§ç³»ç»Ÿ
