# AutoM2026 项目架构总结 （2026 Feb 12）

## 项目定位
**本地个人使用的加密货币策略交易系统**，支持模拟交易（Paper Trading），基于 Python + FastAPI + SQLite，前端为 Jinja2 模板渲染。

## 技术栈
| 层级 | 技术 |
|---|---|
| Web 框架 | FastAPI + Jinja2 (SSR 模板渲染) |
| 数据库 | SQLite + SQLAlchemy 2.0 (异步) |
| 调度器 | APScheduler (AsyncIOScheduler) |
| 数据采集 | aiohttp (Binance公开API) |
| 爬虫 | Playwright (ETF flow 等数据) |
| LLM | OpenRouter API (可选，httpx) |
| 运行方式 | uvicorn (开发模式，reload) |

## 目录结构与职责

```
AutoM2026/
├── config/              # 配置层 (settings.py: DB/API/调度/LLM 配置)
├── core/                # 核心基础设施
│   ├── database.py      # SQLAlchemy 异步引擎 + 会话管理
│   ├── scheduler.py     # APScheduler 策略调度器 (加载/执行/管理策略)
│   ├── llm_service.py   # OpenRouter LLM 客户端 (重试/异步)
│   └── monitor.py       # 系统监控 (API 状态记录)
├── models/              # 数据模型层 (SQLAlchemy ORM)
│   ├── strategy.py      # 策略配置 (ta/macro/grid 三种类型)
│   ├── trade.py         # 交易记录
│   ├── position.py      # 持仓信息
│   ├── grid_order.py    # 网格订单
│   ├── strategy_execution.py  # 策略执行历史 (可观测性)
│   ├── market_watch.py  # 行情监控列表
│   ├── crawler.py       # 爬虫相关 (CrawlSource/Task/Data)
│   └── system.py        # API 状态表
├── strategies/          # 策略实现层
│   ├── base.py          # 基类 (BaseStrategy + StrategySignal)
│   ├── ta_strategy.py   # 技术指标策略 (EMA/RSI/MACD/BBands 综合评分)
│   ├── macro_strategy.py # 宏观趋势策略 (F&G + FRED + LLM 混合分析)
│   └── grid_strategy.py # 网格交易策略
├── data_collectors/     # 数据采集层
│   ├── binance.py       # Binance 价格/K线/Ticker (公开API)
│   ├── fear_greed.py    # Fear & Greed Index (alternative.me)
│   ├── fred_collector.py # FRED 宏观数据 (利率/美债/DXY/M2)
│   └── stablecoin_collector.py # 稳定币市值
├── indicators/          # 技术指标计算
│   └── calculator.py    # EMA/RSI/MACD/BBands/ATR (纯数学计算)
├── execution/           # 交易执行层
│   └── paper_engine.py  # 模拟交易引擎 (记录Trade + 更新Position)
├── crawler/             # 爬虫模块 (Playwright)
│   ├── core.py          # 爬虫引擎 (管理浏览器生命周期)
│   ├── scheduler.py     # 爬虫调度
│   └── spiders/         # 具体爬虫 (farside.py - ETF flow)
├── web/                 # Web UI (Jinja2 SSR)
│   ├── app.py           # FastAPI 路由 (页面 + API)
│   ├── templates/       # HTML 模板 (index/strategies/trades/positions/market等)
│   └── static/          # CSS + JS
├── scripts/             # 数据库迁移/测试脚本
├── main.py              # 入口 (uvicorn 启动)
└── data/                # SQLite 数据库文件
```

## 核心业务流程

1. **策略生命周期**: 创建策略 → 启动(ACTIVE) → 调度器定时执行 → 分析市场数据 → 生成信号(BUY/SELL/HOLD) → 执行模拟交易 → 记录执行历史
2. **三种策略类型**:
   - **TA (技术分析)**: 多时间框架 K 线 → EMA/RSI/MACD/BBands 评分 → 综合信号
   - **Macro (宏观)**: F&G + FRED 宏观指标 + 价格趋势 → 规则评分 + 可选 LLM 深度分析
   - **Grid (网格)**: 价格区间自动低买高卖
3. **数据流**: Binance API → 指标计算 → 策略分析 → 信号生成 → Paper Trading 执行

## 当前状态
- 功能相对完整的 v1.0 版本
- 纯 SSR 渲染 (Jinja2 模板)，无前端框架
- 仅支持模拟交易
- SQLite 单文件数据库

## 开发建议
- 当前系统结构清晰，后续可拓展：实盘交易接口、前端框架、消息队列、Docker部署等
- 策略层已预留接口，支持快速增加新类型策略
- 调度器、爬虫、LLM 均为模块化设计，可独立升级或替换